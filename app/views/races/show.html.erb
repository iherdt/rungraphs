<%- model_class = Race -%>
<div class="results-page-header page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.titleize %></h1>
  
  <dl class="dl-horizontal">
    <% @race.attributes.each do |attribute, value| %>
      <% next if value.nil? %>
      <% next if ["club_points", "id", "created_at", "updated_at"].include? attribute %>
      <dt><strong><%= model_class.human_attribute_name(attribute) %>:</strong></dt>
      <dd><%= value%></dd>
    <% end %>
  </dl>
</div>


<div class="race-page-content">
  <div class="race-results-table">
      <table class="results-table table table-hover">
          <thead>
              <tr>
                  <th>O</th>
                  <th>G</th>
                  <th>A</th>
                  <th>Name</th>
                  <th>Team</th>
                  <th>Sex</th>
                  <th>Age</th>
                  <th>Bib</th>
                  <th>Time</th>
                  <th>Pace</th>
                  <th>AG Time</th>
                  <th>AG%</th>
              </tr>
          </thead>
          <tfoot>
            <tr>
                  <th>O</th>
                  <th>G</th>
                  <th>A</th>
                  <th>Name</th>
                  <th>Team</th>
                  <th>Sex</th>
                  <th>Age</th>
                  <th>Bib</th>
                  <th>Time</th>
                  <th>Pace</th>
                  <th>AG Time</th>
                  <th>AG%</th>
            </tr>
          </tfoot>
          <tbody>
              <% @race.results.sort_by(&:overall_place).each do |result| %>
                <tr>
                    <td><%= result.overall_place %></td>
                    <td><%= result.gender_place %></td>
                    <td><%= result.age_place %></td>
                    <td><%= result.first_name + ' ' + result.last_name %></td>
                    <td><%= result.team %></td>
                    <td><%= result.sex %></td>
                    <td><%= result.age %></td>
                    <td><%= result.bib %></td>
                    <td><%= result.finish_time %></td>
                    <td><%= result.pace_per_mile %></td>
                    <td><%= result.ag_time %> </td>
                    <td><%= result.ag_percent %>%</td>
                </tr>
              <% end %>
          </tbody>
      </table>
  </div>
</div>

<script>
$(document).ready(function(){
  var $resultsTable = $('.results-table').dataTable( {
      "aaSorting": [],
      "aoColumnDefs": [
        { "orderable": false, "targets": "_all" }
      ],
      "pagingType": "full",
      "dom": "<'results-table-header group'fpi>",
      "lengthMenu": [ 50 ],
      // "responsive": true,
      "columns": [
        { "width": "34px" },
        { "width": "34px" },
        { "width": "34px" },
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ]
    });
    
    new $.fn.dataTable.FixedHeader( $resultsTable, {
      "offsetTop": 40
    } );

    // Setup - add a text input to each footer cell
    $('.results-table tfoot th').each( function () {
        var title = $('.results-table thead th').eq( $(this).index() ).text();
        $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
    } );
 
    // DataTable
    var table = $('.results-table').DataTable();
 
    // Apply the search
    .columns().eq( 0 ).each( function ( colIdx ) {
        $( 'input', table.column( colIdx ).footer() ).on( 'keyup change', function () {
            table
                .column( colIdx )
                .search( this.value )
                .draw();
        } );
    } );

    // $('.results-table').dataTable().columnFilter({aoColumns: [
    //     { type: "checkbox", values: [ 'Gecko', 'Trident'] },
    //     {},
    //     {},
    //     {},
    //     { type: "checkbox", values: [ 'A', 'C']  },
    //     {},
    //     {},
    //     {},
    //     {},
    //     {},
    //     {},
    //     {}
    //   ]});

});
</script>