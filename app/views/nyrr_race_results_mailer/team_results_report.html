<h3 style="font-weight:bold;font-size:18px;color:#000000;text-align:center;">
  <%= @team_code.upcase %> Team Results for the week of <%= Time.now.in_time_zone("Eastern Time (US & Canada)").to_date.strftime("%m/%d/%y") %>
</h3>

<hr style="height:1px;color:#ccc;"/>
<% @races.each do |race| %>
  <% race_info = race[0] %>
  <% results = race[1] %>
  <% prs = race[2] %>
  <% new_team_racers = race[3] %>
  <% ag_award_results = race[4] %>
  <% team_results = race[5] %>

  <p style="font-weight:bold;font-size:16px;text-align:center;"> <%= race_info[:name] %> - <%= race_info[:date].strftime("%m/%d/%y") %></p>

  <% team_results.each do |type, team_result| %>
    <% runners = JSON.parse(team_result[:runners].gsub('\"', '"').gsub('=>',':')) %>
    <h3> <%= type %> </h3>
    <table cellspacing="0" style="font-family:'lucida grande',arial,sans-serif;width:30%;text-align:center">
      <thead>
      <tr>
        <th>Place: <%= team_result[:team_place] %></th>
        <th><%= team_result[:total_time] %></th>
      </tr>
      </thead>
      <tbody>
      <% (0..(team_result[:number_of_scoring_runners] - 1)).each do |place| %>
          <tr style="<%= cycle("background-color:#efefef", "") %>">
            <td><%= runners[place.to_s]["name"].split.map(&:capitalize).join(' ') %></td>
            <td><%= runners[place.to_s]["net_time"] %></td>
          </tr>
      <% end %>
      </tbody>
    </table>
    <br>
    <br>
  <% end %>

  <% if !prs.empty? %>
    <h3>PRs (only by NYRR races)</h3>
    <table cellspacing="0" style="font-family:'lucida grande',arial,sans-serif;width:100%;text-align:center">
      <thead>
      <tr>
        <th>Name</th>
        <th>PR Time</th>
        <th>Previous Best Time</th>
        <th>Previous Best Race</th>
        <th>Previous Best Date</th>
      </tr>
      </thead>
      <tbody>
      <% prs.each do |pr| %>
          <tr style="<%= cycle("background-color:#efefef", "") %>">
            <td><%= pr[:name].split.map(&:capitalize).join(' ') %></td>
            <td><%= pr[:pr_time] %></td>
            <td><%= pr[:old_pr_time] %></td>
            <td><%= pr[:old_pr_race] %></td>
            <td><%= pr[:old_pr_date] %></td>
          </tr>
      <% end %>
      </tbody>
    </table>
    <br>
    <br>
  <% end %>

  <% if !ag_award_results.empty? %>
    <h3>Age Group Awards</h3>
    <table cellspacing="0" style="font-family:'lucida grande',arial,sans-serif;width:50%;text-align:center">
      <thead>
      <tr>
        <th>Age Place</th>
        <th>Name</th>
        <th>Age</th>
        <th>Gender</th>
        <th>Time</th>
      </tr>
      </thead>
      <tbody>
      <% ag_award_results.each do |result| %>
          <tr style="<%= cycle("background-color:#efefef", "") %>">
            <td><%= result[:age_place] %></td>
            <td><%= result[:name].split.map(&:capitalize).join(' ') %></td>
            <td><%= result[:age] %></td>
            <td><%= result[:gender] %></td>
            <td><%= result[:time] %></td>
          </tr>
      <% end %>
      </tbody>
    </table>
    <br>
    <br>
  <% end %>

  <% if !new_team_racers.empty? %>
    <h3>First race with <%= @team_code.upcase %>!</h3>
    <% new_team_racers.each do |racer| %>
      <%= racer[:name].split.map(&:capitalize).join(' ') %><br>
    <% end %>
    <br>
    <br>
  <% end %>

  <h3>Team Results</h3>
  <table cellspacing="0" style="font-family:'lucida grande',arial,sans-serif;width:100%;text-align:center">
    <thead>
    <tr>
      <th>Overall</th>
      <th>Gender</th>
      <th>Age</th>
      <th>Name</th>
      <th>Gender</th>
      <th>Pace</th>
      <th>Net Time</th>
      <th>Age</th>
      <th>AG Gender</th>
      <th>AG Percent</th>
      <th>City</th>
      <th>State</th>
      <th>Country</th>
    </tr>
    </thead>
    <tbody>
    <% results.each do |result| %>
        <tr style="<%= cycle("background-color:#efefef", "") %>">
          <td><%= result[:overall_place] %></td>
          <td><%= result[:gender_place] %></td>
          <td><%= result[:age_place] %></td>
          <td><%= result[:name].split.map(&:capitalize).join(' ') %></td>
          <td><%= result[:gender] %></td>
          <td><%= result[:pace] %></td>
          <td><%= result[:net_time] %></td>
          <td><%= result[:age] %></td>
          <td><%= result[:ag_gender_place] %></td>
          <td><%= sprintf('%.2f', result[:ag_percent]) %></td>
          <td><%= result[:city] %></td>
          <td><%= result[:state] %></td>
          <td><%= result[:country] %></td>
        </tr>
    <% end %>
    </tbody>
  </table>
  <br>
  <br>
<% end %>